<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<select id="selectAllBoard" resultMap="boardMap">
		<![CDATA[
			SELECT
				*
			FROM
				(
				SELECT
					rownum rn,
					tb1.*
				FROM
					(SELECT
						b.*,
						(SELECT EMP_NAME FROM emp e WHERE b.EMP_NO = e.EMP_NO) emp_name, 
						(select count(*) from attachment where board_no = b.no) attach_count, 
						(select count(*) from board_comment where board_no = b.no) comment_count
					FROM
						board b
					WHERE
						b.delete_yn = 'N'
					ORDER BY 
						reg_date DESC
					) tb1
				WHERE
					rownum <= #{cri.pageNum} * #{cri.amount}
			)
			WHERE
				rn > (#{cri.pageNum} - 1) * #{cri.amount}
		]]>
	</select>
	
	<resultMap type="board" id="boardMap">
		<id column="no" property="no"/>
		<result column="title" property="title"/>
		<result column="content" property="content"/>
		<result column="reg_date" property="regDate"/>
		<result column="read_count" property="readCount"/>
		<result column="like_count" property="likeCount"/>
		<result column="report_yn" property="reportYn"/>
		<result column="emp_no" property="empNo"/>
		<result column="category" property="category"/>
		<result column="delete_yn" property="deleteYn"/>
		<result column="attach_count" property="attachCount"/>
		<result column="comment_count" property="commentCount"/>
		<association property="emp" resultMap="empMap"/>
	</resultMap>
	
	<resultMap type="emp" id="empMap">
		<id column="emp_no" property="empNo"/>
		<result column="emp_name" property="empName" />
	</resultMap>
	
	<select id="selectTotalBoardCount" resultType="int">
		SELECT
			count(*)
		FROM
			board
		WHERE
			delete_yn = 'N'
	</select>
</mapper>